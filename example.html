<!DOCTYPE HTML>
<html>
  <head>
    <title>Dominos</title>
    <script src="dist/kid.js"></script>
  </head>
  <body>
    <script type="kidjs">

      import "neural-network"

      let net = neuralNetwork()

      gravity = 0
      friction = 0
      floor = false

      let computer = rect(width / 2, height - 50, width / 5, 20)
      let hits = 0
      let state
      let mode = 'TRAINING'

      fontColor = 'lightgray'
      display(20, 20, hits)
      display(width / 2, height / 2, mode)

      let ball = circle(width / 2, height / 2, 40)
      on('frame', checkBallPosition)
      ball.on('collision', moveComputerPaddle)

      function launchTrainingBall() {
        let pushX = random(-10, 10)
        let pushY = random(5, 10)
        ball.x = random(0, width)
        ball.y = random(0, height / 2)
        ball.push(pushX, pushY)
        moveComputerPaddle()
      }

      function checkBallPosition() {
        console.log(ball.y)
        if (ball.y > height) {
          ball.speed = 0
          launchTrainingBall()
        }
      }

      launchTrainingBall()

      function moveComputerPaddle() {
        wait(0.01)
        state = [ball.x, ball.y, ball.velocity.x, ball.velocity.y];
        let x
        if (mode == 'TRAINING') {
          x = random(0, width)
        } else {
          x = net.run(state)
        }
        computer.moveTo(x, computer.y)
      }

      function success() {
        if (mode == 'TRAINING') {
          hits = hits + 1
          net.train(state, computer.x)
        }
      }

      computer.on('collision', success)

      ball.on('move', checkBallPosition)

      function startGame() {
        mode = 'GAME'
      }

      on('space', startGame)

/*
      function placeDomino(x, y) {
        let domino = rect(x, y, 20, 100)
        domino.anchored = false
        domino.bounciness = 0
      }

      for (let x = 200; x < width - 200; x = x + 60) {
        placeDomino(x, 200)
      }
      
      let startX
      let startY
      let marble

      function start() {
        startX = mouseX
        startY = mouseY
        marble = circle(startX, startY, 50)
      }

      function dragging() {
        if (mouseButton) {
          marble.x = mouseX
          marble.y = mouseY
        }
      }

      function release() {
        marble.push(startX - mouseX, startY - mouseY)
      }

      on('mousedown', start)
      on('mousemove', dragging)
      on('mouseup', release)*/

    </script>
  </body>
</html>
