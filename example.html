<!DOCTYPE HTML>
<html>
  <head>
    <title>Dominos</title>
    <script src="dist/kid.js"></script>
  </head>
  <body>
    <script type="kidjs">

      import "neural-network"

      let net = neuralNetwork()

      gravity = 0
      friction = 0
      floor = false
      ceiling = false

      let computer = rect(width / 2, height - 50, width / 4, 20)
      let hits = 0
      let misses = 0
      let state
      let mode = 'TRAINING'

      fontColor = 'lightgray'
      display(40, 40, hits)
      display(width - 40, 40, misses)
      display(width / 2, height / 2, mode)

      let ball = circle(width / 2, 50, 40)

      on('frame', checkBallPosition)
      ball.on('collision', onBounce)

      function onMouseMove() {
        if (mode == 'TRAINING') {
          computer.x = mouseX
        }
      }

      on('mousemove', onMouseMove)

      function onBounce() {
        wait(0.01)
        state = [ball.x, ball.y, ball.velocity.x, ball.velocity.y];

        if (mode == 'AUTOPILOT') {
          let x = net.run(state)
          computer.moveTo(x, computer.y)
        }
      }


      function checkBallPosition() {
        if (ball.speed == 0) {
          let pushX = random(-10, 10)
          let pushY = random(2, 8)
          ball.push(pushX, pushY)
          onBounce()
        }
        if (ball.y < 0 || ball.y > height) {
            ball.speed = 0
            ball.x = random(0, width)
            ball.y = 50
        }
        if (ball.y > height) {
          misses = misses + 1
        }
      }

      function success() {
          hits = hits + 1
          net.train(state, computer.x)
      }

      computer.on('collision', success)

      ball.on('move', checkBallPosition)

      function startGame() {
        mode = 'AUTOPILOT'
        hits = 0
        misses = 0
      }

      on('space', startGame)


    </script>
  </body>
</html>
